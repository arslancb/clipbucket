<h2>{lang('ldap_configuration')}</h2>


<div class="tabbable">
	<ul class="nav nav-tabs" id="myTab">
		<li class="{if $tabactive eq ''}active{/if}"><a data-toggle="tab" href="#cnxtab">Connexion</a></li>
		<li class="{if $tabactive == 'datatab'}active{/if}"><a data-toggle="tab" href="#datatab">Correspondance des données</a></li>
		<li class="{if $tabactive == 'testtab'}active{/if}"><a data-toggle="tab" href="#testtab">Test</a></li>
	</ul>

	<!-- 
		Tab de configuration de la connexion
	-->
	<div class="tab-content">
		<div id="cnxtab" class="tab-pane{if $tabactive eq ''} active{/if}">
			<h2>{lang('ldap_configuration')}</h2>		

			<form class="form-horizontal" role="form" method="post">

				<div class="form-group">
					<label for="ldap_host" class="col-sm-2 control-label">{lang('ldap_host')}</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="ldap_host" id="ldap_host" value="{$ldap_host}" placeholder="ldap.domain.com">
					</div>
				</div>
	
				<div class="form-group">
					<label for="ldap_port" class="col-sm-2 control-label">{lang('ldap_port')}</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="ldap_port" id="ldap_port" value="{$ldap_port}" placeholder="Ex : 389">
					</div>
				</div>
				<div class="form-group">
					<label for="ldap_filtre" class="col-sm-2 control-label">{lang('ldap_filtre')}</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="ldap_filtre" id="ldap_filtre" value="{$ldap_filtre}" placeholder="Ex : uid=">
					</div>
				</div>
				<div class="form-group">
					<label for="ldap_basedn" class="col-sm-2 control-label">{lang('ldap_basedn')}</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="ldap_basedn" id="ldap_basedn" value="{$ldap_basedn}" placeholder="Ex">
					</div>
				</div>


				<div class="form-group">
					<div class="col-sm-8 col-sm-offset-2">
						<input type="submit" class="btn btn-primary" name="update_config" id="update_config" value="{lang('ldap_update_config')}">
					</div>
				</div>
			</form>
		</div>

		<!-- 
			Tab de correspondane des données
		-->
		<div id="datatab" class="tab-pane{if $tabactive == 'datatab'} active{/if}">
			
			<h2>Récupération de champ</h2>
			<p>Vous pouvez établir une correspondance de champs.</p>
			
			<p>L'attribut LDAP mail est automatiquement inclus, il n'est pas utile de le définir ici.</p>
			
			<p>Le champ ClipBucket doit correspondre au nom du champs de la base de données de la table "user_profile".</p>

			{if $ldap_fields_connection}
				{$tab_config = json_decode(html_entity_decode($ldap_fields_connection))}
			{/if}
			
			<form class="form-horizontal" role="form" method="post">
				<div id="champs">
					{foreach from=$tab_config item=name key=key name=sorts}
						{include file="$ldap_layout_dir/blocks/form_attribut.html" cleldap=$key clecb=$name}
					{/foreach}

					{include file="$ldap_layout_dir/blocks/form_attribut.html" cleldap='' clecb=''}
				</div>
					
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-1">
						<button type="button" onclick="addField()" class="btn btn-primary">+</button>
					</div>
					
					<div class="col-sm-9">
						<input type="submit" class="btn btn-primary" name="update_config" id="update_config" value="{lang('ldap_update_config')}">
					</div>
				</div>
			</form>
			
		</div>

		<!-- 
			Tab de test
		-->
		<div id="testtab" class="tab-pane{if $tabactive == 'testtab'} active{/if}">
			
			<h2>{lang('ldap_recherche')}</h2>
			
			<form class="form-horizontal" role="form" method="post">
			
				<div class="form-group">
					<label for="ldap_host" class="col-sm-2 control-label">{lang('search')}</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="search" id="search" value="{$smarty.post.search}" placeholder="search">
					</div>
				</div>

				<div class="form-group">
					<div class="col-sm-8 col-sm-offset-2">
						<input type="submit" class="btn btn-primary" name="btn_search" id="btn_search" value="{lang('btn_search')}">
					</div>
				</div>
			</form>
	
			{if $ldap_result}
			<pre>
			<b>LDAP Result :</b>
			{print_r($ldap_result)}
			</pre>
			{/if}
			
		</div>



	</div>
</div>



{literal}
	<script type="text/javascript">
        function addField() {
        	$("#champs").append('<div class="form-group"><label for="cas_context" class="col-sm-2 control-label">Attribut LDAP</label><div class="col-sm-3"><input type="text" class="form-control" name="cle_ldap[]" id="cle_ldap[]" value="" placeholder=""></div><label for="cas_context" class="col-sm-2 control-label">Champ ClipBucket</label><div class="col-sm-3"><input type="text" class="form-control" name="cle_cb[]" id="cle_cb[]" value="" placeholder=""></div></div>');
        }
    </script>
{/literal}
